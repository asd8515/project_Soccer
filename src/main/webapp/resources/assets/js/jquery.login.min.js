var $username = $("#username"),
    $password = $("#password"),
    $confirmation = $("#confirm_password"),
    $submit = $("#submit"),
    $hints = $("form span");

//hide hints
$hints.hide();

//check if submission is allowed
var canSubmit = function () {
    return usernameGiven() && usernameValid() && passwordValid() && matchConfirmed();
};

//check if username is given
var usernameGiven = function () {
    return $username.val().length > 0;
};

//check if username is valid
var usernameValid = function () {
    var str = $username.val();
    return /^[a-zA-Z0-9]*$/.test(str);
};

//check is password is valid
var passwordValid = function () {
    return $password.val().length > 8;
};

//check if confirmation matches password
var matchConfirmed = function () {
    return $password.val() === $confirmation.val();
};

var validationEvent = function (field, isValid) {
  if (isValid()) {
    field.next().hide();
  } else {
    field.next().show();
  }
}

var usernameEvent = function () {
  validationEvent($username, usernameValid);
};

var passwordEvent = function () {
  validationEvent($password, passwordValid);
};

var confirmationEvent = function () {
  validationEvent($confirmation, matchConfirmed);
};

var enableSubmitEvent = function () {
    $submit.prop("disabled", !canSubmit());
};

//when user focuses on $username
$username.focus(usernameEvent).keyup(usernameEvent).keyup(confirmationEvent).keyup(enableSubmitEvent);

//when user focuses on $password
$password.focus(passwordEvent).keyup(passwordEvent).keyup(confirmationEvent).keyup(enableSubmitEvent);

//when user focuses on $confirmation
$confirmation.focus(confirmationEvent).keyup(confirmationEvent).keyup(enableSubmitEvent);

enableSubmitEvent();
