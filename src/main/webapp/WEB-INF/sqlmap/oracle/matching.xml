<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="matching">
	<select id="list" resultType="Map" parameterType="Map">
		select * from member

<!-- 	    SELECT r.region as region
            , l."LEVEL" as level_name
            , b.message as message
            , m.name as name
            , b.matched as matched
            , b.writedate as writedate
		FROM BOARD b INNER JOIN REGION r ON b.id_region = r.id_region
                     INNER JOIN FB_LEVEL l ON b.id_level = l.id_level
                     INNER JOIN MEMBER m ON b.member_seq = m.member_seq
 		<where>
 			<choose>
			    <when test="SEARCH_OPTION == null">
			        and 1=1
			    </when>
			    <when test="SEARCH_OPTION == 'BY_LOCATION'">
			    	and r.region LIKE '%' || #{SEARCH_KEYWORD} || '%'
			    </when>
			    <when test="SEARCH_OPTION == 'BY_LEVEL'">
			    	대소문자 구문 안하도록 : 둘 다 소문자로 만들어서 비교.
			    	and lower(l."LEVEL") LIKE '%' || lower(#{SEARCH_KEYWORD}) || '%'
			    	찐우 원본 코드
			    	and (l."LEVEL" LIKE '%' || #{SEARCH_KEYWORD} || '%'
			    </when>
			    <otherwise>
			    	and 1=1
			    </otherwise>
		    </choose>
		</where> -->
	</select>

	<select id="read" resultType="Map" parameterType="Map">
	    select *
		from MEMBER
		<where>
			and MEMBER_SEQ = #{MEMBER_SEQ}
		    <!-- choose>	using by CustomizeUserDetailsService.java
		        <when test="MEMBER_ID != null">
					and MEMBER_ID = #{MEMBER_ID}
		        </when>
		        <when test="MEMBER_SEQ != null">
					and MEMBER_SEQ = #{MEMBER_SEQ}
		        </when>
		    </choose-->
		</where>
	</select>

	<insert id="merge" parameterType="Map">
	
		MERGE INTO BOARD B1 
		     USING (SELECT #{GAME_SEQ} AS GAME_SEQ FROM DUAL) B2
				ON (B1.GAME_SEQ = B2.GAME_SEQ)
		WHEN MATCHED THEN 
			UPDATE SET
				ID_REGION   = #{ID_REGION}
				, ID_LEVEL  = #{ID_LEVEL}
				, MESSAGE	= #{MESSAGE}
				, "MATCHED"	= #{MATCHED}
		WHEN NOT MATCHED THEN 
			INSERT(
				GAME_SEQ
				, ID_REGION
				, ID_LEVEL
				, MESSAGE
				, MEMBER_SEQ
				, "MATCHED"
				, WRITEDATE
			)
			values(
				#{GAME_SEQ}
				, #{ID_REGION}
				, #{ID_LEVEL}
				, #{MESSAGE}
				, #{MEMBER_SEQ}
				, #{MATCHED}
				, SYSDATE
			)
		
	</insert>

	<delete id="delete" parameterType="Map">
		delete from MEMBER
		where MEMBER_SEQ = #{MEMBER_SEQ}
	</delete>
</mapper>